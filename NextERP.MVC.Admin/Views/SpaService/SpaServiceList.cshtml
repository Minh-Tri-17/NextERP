@model APIBaseResult<PagingResult<SpaServiceModel>>

<div class="table-container">
	<table class="table table-hover me-2">
		<thead>
			<tr>
				<th>
					<div class="form-check">
						<input class="check-all form-check-input" type="checkbox" />
					</div>
				</th>
				<th>#</th>
				@{
					var excludedFields = new[] { Constants.AllowPaging, Constants.PageIndex, Constants.PageSize, Constants.Id, Constants.Ids, Constants.IsDelete };

					var listField = UtilHtmlHelper.GetOrderedProperties<SpaServiceModel>(excludedFields);

					foreach (var item in listField)
					{
						<th localize-content>@item.Name</th>
					}
				}
			</tr>
		</thead>

		<tbody class="sortable-group table-group-divider">
			@if (DataHelper.ListIsNotNull(Model))
			{
				int counter = (Model!.Result!.PageIndex - 1) * Model.Result.PageSize + 1;

				foreach (var row in Model!.Result!.Items!)
				{
					<tr>
						<td>
							<input type="hidden" name="@SpaServiceModel.AttributeNames.SpaServiceId" value="@row.Id" />
							<div class="form-check">
								<input class="form-check-input @TableName.SpaService-checkbox" type="checkbox" />
							</div>
						</td>
						<td>@counter</td>
						@foreach (var field in listField)
						{
							var value = field.GetValue(row);

							string statusColorClass = string.Empty;

							if (field.Name == nameof(Enums.OperatingStatus).ToString()
								|| field.Name == nameof(Enums.SpaServiceLevel).ToString())
							{
								switch (value)
								{
									case nameof(Enums.OperatingStatus.Active):
										statusColorClass = "status-color-success";
										break;
									case nameof(Enums.OperatingStatus.Inactive):
										statusColorClass = "status-color-danger";
										break;
									case nameof(Enums.SpaServiceLevel.Basic):
										statusColorClass = "status-color-primary";
										break;
									case nameof(Enums.SpaServiceLevel.Premium):
										statusColorClass = "status-color-secondary";
										break;
									case nameof(Enums.SpaServiceLevel.Advanced):
										statusColorClass = "status-color-purple";
										break;
								}
							}

							if (field.PropertyType == typeof(decimal) || field.PropertyType == typeof(decimal?))
							{
								<td>
									@{
										decimal decimalValue = value != null ? Convert.ToDecimal(value) : 0;
										string formattedValue;
										if (decimalValue < 1000)
										{
											formattedValue = string.Format("{0:#,##0} {1}", decimalValue, Constants.Currency);
										}
										else if (decimalValue < 1000000)
										{
											formattedValue = string.Format("{0:#,##0.###}K {1}", decimalValue / 1000, Constants.Currency);
										}
										else
										{
											formattedValue = string.Format("{0:#,##0.###}M {1}", decimalValue / 1000000, Constants.Currency);
										}
									}
									@formattedValue
								</td>
							}
							else
							{
								<td><span localize-content class="@statusColorClass">@Html.Raw(value ?? "")</span></td>
							}
						}
					</tr>

					counter++;
				}
			}
		</tbody>
	</table>
</div>

@if (DataHelper.ListIsNotNull(Model))
{
	<nav id="pagination-container" aria-label="Page navigation">
		@await Component.InvokeAsync(Constants.Pagination, Model.Result)
	</nav>
}

<script>
	$(function () {
		// Kích hoạt strict mode cho toàn bộ code bên trong hàm này
		'use strict';

		$("#pagination-container").on("click", ".page-link", function () {
			const $pageIndex = $(this).data("page");
			if (!$pageIndex) return;

			// Xử lý active
			$("#pagination-container .page-item").removeClass("active");
			$(this).parent().addClass("active");

			const $searchForm = $("#@TableName.SpaService-search-form");

			loadSpaServices($searchForm, $pageIndex);
		});

		$(".check-all").change(function () {
			// Gán giá trị cho tất cả checkbox SpaService-checkbox
			$(".@TableName.SpaService-checkbox").prop("checked", $(this).is(":checked") ? true : false);

			// Kiểm tra số lượng checkbox đã chọn và cập nhật trạng thái của các nút
			const $length = $(".@TableName.SpaService-checkbox:checked").length;
			checkLengthCheckbox($length, true, true, true, true, "@TableName.SpaService-checkbox");
		});
	});
</script>